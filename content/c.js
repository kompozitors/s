/*
FunPay Lite Bot
Copyright (c) 2022-2025 Leonid Tsaruk aka NightStranger
Source c.js
Build 346a8139-3827-4b6b-a715-7c02d91f725e
*/
(()=>{function De(e,t=!1){let o=new Date,r=o.getDate().toString(),n=(o.getMonth()+1).toString(),i=o.getFullYear().toString(),l=o.getHours().toString(),c=o.getMinutes().toString(),u=o.getSeconds().toString();r.toString().length==1&&(r=`0${r}`),n.toString().length==1&&(n=`0${n}`),l.toString().length==1&&(l=`0${l}`),c.toString().length==1&&(c=`0${c}`),u.toString().length==1&&(u=`0${u}`);let g=`>[${r}.${n}.${i}] [${l}:${c}:${u}] >LB: ${e}`;t?console.error(g):console.log(g),typeof e=="object"&&console.log(e)}var s=De;async function qe(e){let t=await chrome.storage.local.get(e);return chrome.runtime.lastError?chrome.runtime.lastError:e==null?t:t[e]}var f=qe;async function Ne(e,t,o=!1){let r={};return o?r=t:r[e]=t,await chrome.storage.local.set(r),chrome.runtime.lastError?chrome.runtime.lastError:!0}var b=Ne;function Fe(){try{let e=document.querySelector(".user-link-name");return e?e.textContent:null}catch(e){return s(`Error while getUserName: ${e}`),null}}var ne=Fe;function He(){try{let e=document.querySelector("body");if(!e)return null;let o=e.dataset.appData;return o?JSON.parse(o):null}catch(e){return s(`Error while getBodyAppData: ${e}`),null}}var ae=He;function H(){try{let e=ae(),t=ne();return{userId:e.userId,userName:t,csrfToken:e["csrf-token"]}}catch(e){return s(`Error while getAppData: ${e}`),null}}function Ae(e){if(!e||e.includes("â‚½"))return"RUB";if(e.includes("$"))return"USD";if(e.includes("â‚¬"))return"EUR"}var se=Ae;function Oe(e){return new Promise(t=>setTimeout(t,e))}var k=Oe;var A=500,je=7,O=0;async function Ve(e,t={},o=je){let r=0,n=0,i=Date.now();for(i-O<A&&(n=A-(i-O)),O=i+n;r<o;){await k(n),r++;try{let l=await fetch(e,t);if(l.status===429)throw new Error("Too many requests");if([403,404,401].includes(l.status))throw new Error(`Request failed with status ${l.status}`);if(l.status>=400)throw new Error(`Unexpected response code: ${l.status}`);return l}catch(l){if(s(`Fetch attempt ${r} failed: ${l.message}`),l.message.includes("Request failed with status"))throw l;n=Math.max(A,n*2)}}throw new Error("Max retries reached")}var ie=Ve;function _e(){return"funpay.com"}var le=_e;function Ge(){return`https://${le()}`}var D=Ge;async function We(e,t,o="RUB"){try{if(t>1e3&&(o=="USD"||o=="EUR"))throw new Error("Cannot get minimum price for USD or EUR currency with price more than 1000.");let r=new URLSearchParams;r.append("nodeId",e.toString()),r.append("price",t);let n={method:"POST",body:r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/javascript, */*; q=0.01","X-Requested-With":"XMLHttpRequest"}},i=D(),u=(await(await ie(`${i}/lots/calc`,n)).json()).methods;if(!u||u.length==0)return;for(let S=0;S<u.length;S++){let h=u[S];h.priceString=h.price.replace(" ",""),h.price=Number(h.priceString)}let g=1e9;for(let S=0;S<u.length;S++){let h=u[S];se(h.unit)==o&&h.price<g&&(g=h.price)}return g}catch(r){throw new Error(`Error in getCategoryMinPrice: ${r}`)}}var ce=We;async function ze(e,t="RUB"){let o=1e5;t!=="RUB"&&(o=1e3);let r=await ce(e,o,t);return(r-o)/r*100}var ue=ze;function Xe(){let e=document.querySelector(".form-control-feedback");if(!e)return"RUB";let t=e.textContent;if(!t||t.includes("â‚½"))return"RUB";if(t.includes("$"))return"USD";if(t.includes("â‚¬"))return"EUR"}var de=Xe;function Ye(e,t){let o=e/(1-t/100);return Math.round(o*100)/100}var me=Ye;function Je(e){return typeof e=="string"?parseFloat(e.replace(/,/g,".")):e}var q=Je;function Ke(){let e=document.querySelector(".js-buyer-price"),t=document.querySelector(".js-seller-price"),o=Number(t.dataset.comission);if(!o)return;let r=q(t.value),n=me(r,o).toString();e.value=n,e.setAttribute("value",n)}var j=Ke;function Qe(e,t){let o=e*(1-t/100);return Math.round(o*1e3)/1e3}var pe=Qe;function Ze(){let e=document.querySelector(".js-buyer-price"),t=document.querySelector(".js-seller-price"),o=Number(e.dataset.comission);if(!o)return;let r=q(e.value),n=pe(r,o).toString();t.value=n,t.setAttribute("value",n);let i=new Event("input");t.dispatchEvent(i)}var fe=Ze;async function et(){let e=Number(document.location.search.split("&")[0].split("=")[1]);if(isNaN(e))return 0;let t=document.querySelector('input[name="price"]');if(!t)return;let o=t.parentElement,r=o.cloneNode(!0),n=r.querySelector('input[name="price"]');t.classList.add("js-seller-price"),t.addEventListener("input",ot),n.name="",n.value="",n.classList.add("js-buyer-price"),n.addEventListener("input",tt);let i=o.querySelector(".control-label");i.textContent=`${i.textContent} (Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ð°)`;let l=r.querySelector(".control-label");l.textContent=`${l.textContent} (Ð´Ð»Ñ Ð¿Ð¾ÐºÑƒÐ¿Ð°Ñ‚ÐµÐ»Ñ)`,o.after(r);let c=await ue(e,de());s(`Category comission: ${c}`),c&&(t.dataset.comission=c,n.dataset.comission=c,j(),s("CustomPrice is loaded."))}function tt(e){fe()}function ot(e){e.isTrusted&&j()}var ge=et;function rt(){document.title=="429 Too Many Requests"&&setTimeout(()=>window.location.reload(),400)}var he=rt;async function nt(){try{let e=document.querySelectorAll("a.tc-item.offer-promo"),t=document.createElement("div");t.classList.add("sc-offer-icons");let o=document.createElement("div");o.classList.add("promo-offer-icon"),o.classList.add("lb-promo-offer-hightlight"),o.style.marginLeft="4px",t.appendChild(o);for(let r of e){let n=r.querySelector(".tc-price");if(!n)continue;let i=n.querySelector(".sc-offer-icons");i?i.appendChild(o.cloneNode(!0)):n.appendChild(t.cloneNode(!0))}}catch(e){s(`Error while hiding balance: ${e}`)}}var Se=nt;async function at(){he();let e=H();e&&b("appData",e);let t=document.location.pathname;await f("viewSellersPromo")==!0&&(t.includes("/lots/")||t.includes("/chips/"))&&t.length>0&&t[t.length-1]=="/"&&(Se(),s("ViewSellersPromo is working.")),await f("customPrices")==!0&&t.includes("/offerEdit")&&(ge(),s("CustomPrices is working."))}var V=at;function _(e,t=2e3){let o=document.querySelector(".wrapper");if(o==null)return;let r=document.querySelector(".LB-notification");r?.remove(),r=document.createElement("div"),r.classList.add("ajax-alert"),r.classList.add("ajax-alert-info"),r.classList.add("LB-notification"),t>2e3?r.classList.add("LB-notification-anim-out-long"):r.classList.add("LB-notification-anim-out"),r.innerHTML=e,o.after(r),setTimeout(()=>{r.remove()},t)}function G(e,t){let o=e.payload.message,r=e.payload.timeout;_(o,r||void 0)}function W(e,t,o){if(!(!e||e.target!=="content"))switch(e.method){case"notification":return G(e,o),!1}}function st(){chrome.runtime.sendMessage({target:"background",method:"ping"}),chrome.runtime.onMessage.addListener((e,t,o)=>W(e,t,o)),document.readyState==="complete"||document.readyState==="interactive"?V():document.addEventListener("DOMContentLoaded",()=>V())}var ye=st;function it(){return chrome.i18n.getMessage("extSmallName")}var B=it;async function lt(e){return new Promise((t,o)=>{let r=document.querySelector("html");if(!r)return o("No target found");let n=new MutationObserver((l,c)=>{let u=document.querySelector(e);u&&(c.disconnect(),t(u))}),i=document.querySelector(e);if(i)return t(i);n.observe(r,{childList:!0,subtree:!0})})}var y=lt;async function ct(){try{let e=D(),t=B(),o=document.createElement("li"),r=await y("ul[class = 'nav navbar-nav navbar-right logged']"),n=chrome.runtime.getURL("assets/fire.svg"),i=chrome.runtime.getManifest().version;window.location.pathname==="/lite"&&localStorage.setItem("LBversion",i);let l=localStorage.getItem("LBversion"),c="";l!==i?c=`<a id="liteBotButton" onclick='document.location.replace("${e}/lite")'><img src="${n}" alt="ðŸ”¥" id="liteBotButtonFireIcon">${t}</a>`:c=`<a id="liteBotButton" onclick='document.location.replace("${e}/lite")'>${t}</a>`,o.innerHTML=c,r&&r.prepend(o)}catch(e){s(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ ÐºÐ½Ð¾Ð¿ÐºÐ¸: ${e}`)}}var ve=ct;function ut(e){let t=document.querySelector(".wrapper"),o=document.querySelector(".notification");o?.remove(),o=document.createElement("div"),o.classList.add("ajax-alert"),o.classList.add("ajax-alert-info"),o.classList.add("notification"),o.classList.add("anim-out"),o.innerHTML=e,t&&t.after(o),setTimeout(()=>{o.remove()},2e3)}var z=ut;async function dt(e){return await b(null,e,!0)}var we=dt;async function mt(e,t,o){let r={};for(let i=0;i<e.length;i++){let l=e[i].name;r[l]=e[i].checked}r.theme=t.value;let n=await we(r);await chrome.runtime.sendMessage({target:"background",method:"saveSettings"}),n?z(chrome.i18n.getMessage("settingsSaved")):z(chrome.i18n.getMessage("settingsNotSaved"))}var X=mt;function pt(e){let t=e.split("{");for(var o=1;o<t.length;o++){let r=t[o].split("}")[0];if(r.includes(" "))continue;let n=chrome.i18n.getMessage(r);n&&(e=e.replace(`{${r}}`,n))}return e}var N=pt;function ft(e){let t=chrome.runtime.getURL("assets/question.png");return e=e.replace(/{imgQuestionSrc}/g,t),e}var be=ft;async function gt(e){let t=document.querySelectorAll(".theme");for(let o=0;o<t.length;o++)t[o].remove();if(e){let o=document.lastElementChild;if(!o)return;let r=document.createElement("style");r.classList.add("theme"),r.innerHTML=localStorage.getItem("LBThemeCSS")||"",o.appendChild(r)}else localStorage.removeItem("LBThemeCSS")}var Y=gt;async function ht(e){let t=chrome.runtime.getURL(e);return await(await fetch(t)).text()}var L=ht;async function St(e){let t=e.target,o=null;if(t){switch(t.value){case"dark":o="content/static/themes/dark.css";break;case"firewatch":o="content/static/themes/firewatch.css";break;case"red_moon":o="content/static/themes/red_moon.css";break;default:o=null;break}if(o==null)Y(!1);else{let r=await L(o);r=r.replace(/<extension-id>/g,chrome.runtime.id),localStorage.setItem("LBThemeCSS",r),Y(!0)}}}var Be=St;async function yt(){localStorage.removeItem("LBThemeCSS"),localStorage.removeItem("LBThemeCSSSupport"),await chrome.storage.local.clear(),await chrome.runtime.sendMessage({target:"background",method:"onResetSettings"})}var Le=yt;async function vt(){confirm(chrome.i18n.getMessage("resetSettingsConfirm"))==!0&&(await Le(),window.location.reload())}var xe=vt;async function wt(e,t){let o=new Map;for(let n=0;n<e.length;n++){let i=e[n].name,l=await f(i);o.set(i,l)}for(let[n,i]of o){if(!i)continue;let l=document.querySelector(`input[name="${n}"]`);l&&(l.checked=!0)}let r=await f("theme");r||(r="light"),t.value=r}var Ee=wt;function bt(e){setInterval(()=>{e.innerHTML=="Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° / FunPay"&&(e.innerHTML=B())},100)}var Ce=bt;async function Bt(){Lt(),xt(),await Et();let e=document.querySelectorAll(".LB"),t=document.querySelector(".js-theme-select");if(!t)return;Ee(e,t);for(let r=0;r<e.length;r++)e[r].addEventListener("input",n=>X(e,t,n));t.addEventListener("input",r=>Be(r)),t.addEventListener("input",r=>X(e,t,r));let o=document.querySelector(".js-settings-reset");o&&o.addEventListener("click",()=>xe())}async function Lt(){try{let e=await y("title");return e&&!e.innerHTML.includes("429")&&(e.innerHTML=B()),Ce(e),e}catch(e){return s("Error in loadDocumentTitle:",!0),s(e),null}}async function xt(){let e=await y(".page-header"),t=chrome.runtime.getManifest().version;e&&(e.innerHTML=`<span>${B()}</span><span class="LB-version">v${t}</span><div class="lb-social footer-block-social"><a class="btn btn-gray btn-round" href="${chrome.i18n.getMessage("socialLinkTelegram")}" target="_blank" rel="nofollow"><i class="fab fa-telegram"></i></a><a class="btn btn-gray btn-round" href="${chrome.i18n.getMessage("socialLinkDiscord")}" target="_blank" rel="nofollow"><i class="fab fa-discord"></i></a></div>`)}async function Et(){let e=localStorage.getItem("LBPageHTMLCache"),t="";e?t=e:t=await L("content/static/litebotpage/main.html");let o=await y(".lead");t=N(t),t=be(t),o&&(o.innerHTML=t,o.style.display="block"),Ct()}async function Ct(){let e=await L("content/static/litebotpage/main.html");localStorage.setItem("LBPageHTMLCache",e)}var Pe=Bt;async function Pt(e){return new Promise((t,o)=>{let r=document.querySelector("html");if(!r)return o("No target found");let n=new MutationObserver((l,c)=>{let u=document.querySelectorAll(e);!u||!u.length||(c.disconnect(),t(u))}),i=document.querySelectorAll(e);if(i&&i.length)return t(i);n.observe(r,{childList:!0,subtree:!0})})}var Te=Pt;async function Tt(){try{if(document.location.pathname.includes("/account/balance")){let t=await Te(".balances-value");for(let o=0;o<t.length;o++)t[o].innerHTML="???"}let e=await y(".badge-balance");e.dataset.balance=e.value,e.innerHTML=e.innerHTML.replace(/\d/g,"?")}catch(e){s(`Error while hiding balance: ${e}`)}}var Re=Tt;var Rt="https://nightssoftware.github.io";async function Ut(){try{let e=`${Rt}/storage/FPLiteBot/media/vk.mp3`,t=await y("source[src='/audio/chat_loud.mp3']"),o=document.querySelector("audio.loud");t.src=e,o.src=e}catch(e){s(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð¼ÐµÐ½Ðµ Ð·Ð²ÑƒÐºÐ° Ð¾Ð¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ñ: ${e}`)}}var Ue=Ut;function J(){let e=`
<style>
    .lb-text-left {
        text-align: left;
    }
    .lb-text-center {
        text-align: center;
    }
    .lb-text-right {
        text-align: right;
    }
    .lb-header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .lb-header-margin {
        margin-top: 15px;
    }
    .lb-header-link {
        cursor: pointer;
    }
    .lb-header-link:hover {
        text-decoration: underline;
    }
</style>

<div class="" style="margin-bottom: 20px;">
    <div class="lb-header-container" style="margin-bottom: 20px;">
        <h1 class="">{statsHeader}</h1>
        <div style="display: flex; align-items: center;">
            <button type="submit" class="btn btn-primary" id="LB-stats-reset">{statsUpdateButton}</button>
            <select class="form-control" id="LB-stats-period" style="width: auto; margin-left: 10px;">
                <option value="today">{statsToday}</option>
                <option value="yesterday">{statsYesterday}</option>
                <option value="24h">{stats24Hours}</option>
                <option value="7d">{stats7Days}</option>
                <option value="30d">{stats30Days}</option>
                <option value="365d">{stats365Days}</option>
                <option value="all">{statsTotalTime}</option>
            </select>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 lb-text-left">
                    <h5>{statsTotalOrders}</h5>
                    <h2 class="lb-header-margin" id="LB-stats-total-orders">?</h2>
                </div>
                <div class="col-md-4 lb-text-center">
                    <h5>{statsTotalrevenue}</h5>
                    <h2 class="lb-header-margin" id="LB-stats-total-revenue">??? â‚½ <span class="balances-delimiter">Â·</span> ??? $ <span class="balances-delimiter">Â·</span> ??? â‚¬</h2>
                </div>
                <div class="col-md-4 lb-text-right">
                    <h5>{statsAverageSalePrice}</h5>
                    <h2 class="lb-header-margin" id="LB-stats-average-sale-price">??? â‚½ <span class="balances-delimiter">Â·</span> ??? $ <span class="balances-delimiter">Â·</span> ??? â‚¬</h2>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-4 lb-text-left">
                    <h5>{statsOrdersClosed}</h5>
                    <h2 class="lb-header-margin" id="LB-stats-orders-closed">?</h2>
                </div>
                <div class="col-md-4 lb-text-center">
                    <h5>{statsPendingConfirmation}</h5>
                    <h2 class="lb-header-margin" id="LB-stats-orders-pending">?</h2>
                </div>
                <div class="col-md-4 lb-text-right">
                    <h5>{statsReturns}</h5>
                    <h2 class="lb-header-margin" id="LB-stats-orders-refund">?</h2>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-4 lb-text-left">
                    <h5>{statsUniqueCustomers}</h5>
                    <h3 class="lb-header-margin" id="LB-stats-unique-customers">-</h3>
                </div>
                <div class="col-md-4 lb-text-center">
                    <h5>{statsTopCustomer}</h5>
                    <h3 class="lb-header-margin lb-header-link" id="LB-stats-top-customer">-</h3>
                </div>
                <div class="col-md-4 lb-text-right">
                    <h5>{statsHighestSale}</h5>
                    <h3 class="lb-header-margin lb-header-link" id="LB-stats-top-sale">-</h3>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6 lb-text-left">
                    <h5>{statsPopularProduct}</h5>
                    <h6 class="lb-header-margin" id="LB-stats-popular-product">-</h6>
                </div>
                <div class="col-md-6 lb-text-right">
                    <h5>{statsPopularCategory}</h5>
                    <h6 class="lb-header-margin" id="LB-stats-popular-category">-</h6>
                </div>
            </div>
        </div>
    </div>
</div>
`;return e=N(e),e}async function K(e,t,o){try{let r={RUB:.011,USD:1,EUR:1.08},n={totalOrders:0,totalClosed:0,totalPending:0,totalRefunded:0,totalRevenue:{RUB:0,USD:0,EUR:0},totalClosedRevenue:{RUB:0,USD:0,EUR:0},totalPendingRevenue:{RUB:0,USD:0,EUR:0},totalRefundedRevenue:{RUB:0,USD:0,EUR:0},averageCheck:{RUB:0,USD:0,EUR:0},uniqueBuyers:new Set,mostPopularProduct:"",mostPopularCategory:"",mostActiveBuyer:{username:"",id:0},mostExpensiveSale:{price:0,currency:"USD",orderId:""}},i=new Map,l=new Map,c=new Map,u={RUB:0,USD:0,EUR:0},g=new Set(["RUB","USD","EUR"]),S=[];for(let d in e)try{let a=e[d];if(t!==null&&a.orderDate>t||o!==null&&a.orderDate<o)continue;S.push(a),n.totalOrders++,n.uniqueBuyers.add(a.buyerId);let p=a.currency;g.has(p)&&(a.orderStatus==="paid"||a.orderStatus==="closed")&&(n.totalRevenue[p]+=a.price,u[p]+=a.price),i.set(a.description,(i.get(a.description)||0)+1),l.set(a.subcategoryName,(l.get(a.subcategoryName)||0)+1);let w=`${a.buyerUsername}|${a.buyerId}`;if(c.set(w,(c.get(w)||0)+1),a.orderStatus==="paid"?(n.totalPending++,g.has(p)&&(n.totalPendingRevenue[p]+=a.price)):a.orderStatus==="closed"?(n.totalClosed++,g.has(p)&&(n.totalClosedRevenue[p]+=a.price)):a.orderStatus==="refunded"&&(n.totalRefunded++,g.has(p)&&(n.totalRefundedRevenue[p]+=a.price)),g.has(p)&&(a.orderStatus==="paid"||a.orderStatus==="closed")){let v=a.price*r[p],E=n.mostExpensiveSale.price*r[n.mostExpensiveSale.currency];v>E&&(n.mostExpensiveSale={price:a.price,currency:p,orderId:a.orderId})}}catch(a){s(`Error in calculateSalesStats: ${a}`),s(a)}for(let d of["RUB","USD","EUR"]){let a=n.totalClosed+n.totalPending;n.averageCheck[d]=a>0?u[d]/a:0}n.uniqueBuyers=n.uniqueBuyers.size,n.mostPopularProduct=[...i.entries()].reduce((d,a)=>a[1]>d[1]?a:d,["",0])[0],n.mostPopularCategory=[...l.entries()].reduce((d,a)=>a[1]>d[1]?a:d,["",0])[0];let h=[...c.entries()].reduce((d,a)=>a[1]>d[1]?a:d,["|",0]);if(h[1]>1){let[d,a]=h[0].split("|");n.mostActiveBuyer={username:d,id:Number(a)}}return console.log(S),n}catch(r){return s(`Error in calculateSalesStats: ${r}`),s(r),null}}async function x(){try{let e=document.getElementById("LB-stats-period"),t=document.getElementById("LB-stats-total-orders"),o=document.getElementById("LB-stats-total-revenue"),r=document.getElementById("LB-stats-average-sale-price"),n=document.getElementById("LB-stats-orders-closed"),i=document.getElementById("LB-stats-orders-pending"),l=document.getElementById("LB-stats-orders-refund"),c=document.getElementById("LB-stats-unique-customers"),u=document.getElementById("LB-stats-top-customer"),g=document.getElementById("LB-stats-top-sale"),S=document.getElementById("LB-stats-popular-product"),h=document.getElementById("LB-stats-popular-category"),d=window.LBSales;if(d||(window.LBSales=await f("sales"),d=window.LBSales),!d||Object.keys(d).length==0)return;let a=null,p=null,w=Date.now(),v=864e5,E=3*60*60*1e3,C=w+E;switch(e.value){case"today":a=null,p=C-C%v-E;break;case"yesterday":a=C-C%v-E,p=C-C%v-v-E;break;case"24h":a=null,p=w-v;break;case"7d":a=null,p=w-7*v;break;case"30d":a=null,p=w-30*v;break;case"365d":a=null,p=w-365*v;break}let m=await K(d,a,p);t.textContent=m.totalOrders||"0",o.innerHTML=$(m.totalRevenue),r.innerHTML=$(m.averageCheck);let T=$(m.totalClosedRevenue),R=$(m.totalPendingRevenue),U=$(m.totalRefundedRevenue);T!="0 â‚½ Â· 0 $ Â· 0 â‚¬"?T=` (${T})`:T="",R!="0 â‚½ Â· 0 $ Â· 0 â‚¬"?R=` (${R})`:R="",U!="0 â‚½ Â· 0 $ Â· 0 â‚¬"?U=` (${U})`:U="",n.innerHTML=`${m.totalClosed}${T}`,i.innerHTML=`${m.totalPending}${R}`,l.innerHTML=`${m.totalRefunded}${U}`,c.textContent=m.uniqueBuyers||"0",u.textContent=m.mostActiveBuyer.username||"-",u.onclick=()=>{m.mostActiveBuyer.id&&window.open(`https://funpay.com/users/${m.mostActiveBuyer.id}/`)};let I="Â¤";m.mostExpensiveSale.currency=="RUB"&&(I="â‚½"),m.mostExpensiveSale.currency=="USD"&&(I="$"),m.mostExpensiveSale.currency=="EUR"&&(I="â‚¬"),g.textContent=`${m.mostExpensiveSale.price} ${I}`,g.onclick=()=>{m.mostExpensiveSale.orderId&&window.open(`https://funpay.com/orders/${m.mostExpensiveSale.orderId}/`)},S.textContent=m.mostPopularProduct||"-",h.textContent=m.mostPopularCategory||"-"}catch(e){s(`Error in setSalesStatsValues: ${e}`),s(e)}}function $(e){let t=[Q(e.RUB,"â‚½"),Q(e.USD,"$"),Q(e.EUR,"â‚¬")].filter(Boolean);return t.length?t.join(' <span class="balances-delimiter">Â·</span> '):"0 â‚½ Â· 0 $ Â· 0 â‚¬"}function Q(e,t){return e?`${$t(e)} ${t}`:""}function $t(e){return Math.round((e+Number.EPSILON)*100)/100}async function Z(e){try{let o=e.target.value;s(`Selected period: ${o}`),localStorage.setItem("LBStatsPeriod",o),await x()}catch(t){s(`Error in statsPeriodSelectChanged: ${t}`),s(t)}}async function ee(){try{let e=document.querySelector(".page-content-full");if(!e)return;let{orders:t}=await chrome.runtime.sendMessage({target:"offscreen",method:"parseSales",payload:{html:e.innerHTML}}),o=await f("sales");o||(o={});for(let r of t)o[r.orderId]=r;await b("sales",o),await b("salesLastUpdate",Date.now()),window.LBSales=o,await x()}catch(e){s(`Error in updatePageSales: ${e}`),s(e)}}async function te(){await chrome.runtime.sendMessage({target:"background",method:"updateSales"})}async function P(e=!0){let t=document.getElementById("LB-stats-reset");e?(t.disabled=!1,t.innerText=chrome.i18n.getMessage("statsUpdateButton")):(t.disabled=!0,t.innerText=chrome.i18n.getMessage("statsUpdateButtonUpdating"))}async function oe(){try{await chrome.runtime.sendMessage({target:"background",method:"resetSalesStorage"}),await chrome.runtime.sendMessage({target:"background",method:"updateSales"}),P(!1)}catch(e){s(`Error in statsReset: ${e}`),s(e)}}async function F(){let e=await f("salesLastUpdate");!e||!(Date.now()-e>2e3)?P(!1):P(!0)}async function re(){try{let e=document.createElement("div");e.innerHTML=J();let t=await y(".orders-table");if(!t)return;let o=document.querySelector('input[name="id"]'),r=document.querySelector('input[name="buyer"]'),n=document.querySelector('select[name="state"]'),i=document.querySelector('select[name="game"]');if(o.value!=""||r.value!=""||n.selectedIndex!=0||i.selectedIndex!=0)return;t.before(e);let l=document.getElementById("LB-stats-period");localStorage.getItem("LBStatsPeriod")&&(l.value=localStorage.getItem("LBStatsPeriod")),l.addEventListener("change",u=>Z(u));let c=document.getElementById("LB-stats-reset");F(),c.addEventListener("click",()=>oe()),setInterval(()=>F(),2e3),te(),document.readyState==="complete"||document.readyState==="interactive"?$e():document.addEventListener("DOMContentLoaded",()=>$e())}catch(e){s(`Error in showSalesStats: ${e}`),s(e)}}async function $e(){await x(),await ee()}async function Mt(){ve(),It(),document.location.pathname.includes("/lite")&&Pe(),document.location.pathname.includes("/orders/trade")&&kt(),Dt()}async function It(){await f("hideBalance")==!0&&(Re(),s("HideBalance is working."))}async function kt(){await f("showSalesStats")==!0&&(re(),s("ShowSalesStats is working."))}async function Dt(){await f("customNotify")==!0&&(Ue(),s("ReplaceNotifySound is working."))}var Me=Mt;async function qt(e){let t=document.createElement("style");if(t.classList.add("theme"),t.innerHTML=e,new MutationObserver((n,i)=>{for(let l of n)if(l.type==="childList"){let c=document.head;c&&(c.appendChild(t),i.disconnect())}}).observe(document.documentElement,{childList:!0}),!document.querySelector(".theme")){let n=document.head;for(;!n;)await k(1),n=document.head;n.appendChild(t)}}var M=qt;function Nt(){let e=localStorage.getItem("LBThemeCSS");e&&M(e)}var Ie=Nt;async function Ft(){let{theme:e}=await chrome.storage.local.get("theme");if(e!=="light"){let t=localStorage.getItem("LBThemeCSSSupport");t||(t=await L("content/static/themes/dark_support.css"),localStorage.setItem("LBThemeCSSSupport",t)),M(t)}else localStorage.removeItem("LBThemeCSSSupport"),M("")}var ke=Ft;Ht();async function Ht(){document.location.host==="funpay.freshdesk.com"?await ke():(Ie(),ye(),Me())}})();
